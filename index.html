<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Instituto Modesto Rodas Alvarado</title>

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Estilos -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <nav class="menu" id="menu">
      <div class="alineacion-imra-logo">
        <a href="index.html">
          <span class="alineacion-logo"><img src="Imagenes/IMRA-logo.png" alt="logo" width="40px"></span>
          <span class="alineacion-imra">IPMRA</span>
        </a>
        <!-- Hamburguesa -->
        <div class="hamburguesa" id="hamburguesa">
          <span></span><span></span><span></span>
        </div>
        <!-- Menú -->
        <ul class="alineacion-menu" id="menu-opciones">
          <li><a href="index.html">Inicio</a></li>
          <li>
            <a href="#">Nosotros <span class="arrow">▼</span></a>
            <ul class="submenu">
              <li><a href="nuestra-identidad.html">Nuestra Identidad</a></li>
              <li><a href="departamentos.html">Departamentos</a></li>
              <li><a href="maestros.html">Maestros</a></li>
              <li><a href="instalaciones.html">Instalaciones</a></li>
            </ul>
          </li>
          <li><a href="carreras.html">Oferta Academica</a></li>
          <li><a href="matriculas.html">Matrículas</a></li>
          <li class="boton-creditos"><a href="creditos.html">Créditos</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <!-- ====== VIDEO DE BIENVENIDA ====== -->
  <section class="video-container">
    <video src="naturaleza.mp4" muted loop autoplay playsinline preload="auto">
      Tu navegador no soporta el elemento <code>video</code>.
    </video>
    <h1>¡BIENVENIDOS!</h1>
    <p>Al instituto más influyente de toda la margen izquierda.</p>
  </section>

  <!-- ====== NUESTRA INSTITUCION ====== -->
  <section class="institucion">
    <h2>Nuestra Institución</h2>
    <p>
      El Instituto Polivalente Modesto Rodas Alvarado se distingue por formar alumnos con mente esclarecida y corazón recto. 
      A través de un sistema educativo que exige disciplina, constancia y respeto mutuo, forjamos una cultura donde el esfuerzo tiene valor, 
      el orden es herramienta, y los principios éticos son guía constante. Aquí no basta con aprender; buscamos que los estudiantes 
      interioricen los valores de integridad, responsabilidad y servicio, para que el conocimiento que adquieren sea instrumento de 
      transformación personal y social.
    </p>
  </section>

  <!-- ====== VIDEO INSTALACIONES ====== -->
  <section class="video-instalaciones">
    <button class="cta">¡Conoce Nuestra Oferta Académica!</button>

  <div class="video-wrap" id="videoWrap" tabindex="0" aria-label="Reproductor de video">
    <video id="videoIPMRA" src="IPMRA.mp4" muted playsinline preload="metadata" aria-label="Video de instalaciones"></video>

    <!-- Controles personalizados -->
    <div class="custom-controls" id="customControls" role="group" aria-label="Controles de video">
      <button id="playPause" class="control-btn" aria-label="Reproducir" title="Reproducir"></button>

      <!-- UN SOLO control para mute + volumen -->
      <div class="vol-control" id="volControl" aria-label="Control de sonido">
        <button id="volBtn" class="control-btn" aria-label="Silenciar / activar sonido" title="Silenciar / activar sonido" aria-expanded="false">
          <!-- icono actualizado por JS -->
        </button>
        <input id="volSlider" class="vol-slider" type="range" min="0" max="1" step="0.01" aria-label="Volumen" />
      </div>

      <div class="progress-container" id="progressContainer" role="slider"
           aria-label="Barra de progreso" aria-valuemin="0" aria-valuemax="100" tabindex="0">
        <div class="progress-buffer" id="progressBuffer"></div>
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <div class="time" id="time" aria-live="polite">0:00</div>

      <!-- Velocidad: botón con menú. La elección se guarda en localStorage -->
      <div class="speed-group" style="position:relative;">
        <button id="speedBtn" class="control-btn" aria-haspopup="true" aria-expanded="false" title="Velocidad de reproducción">1×</button>
        <div id="speedMenu" class="speed-menu" role="menu" aria-hidden="true">
          <button class="speed-option" data-speed="0.5" role="menuitem">0.5×</button>
          <button class="speed-option" data-speed="0.75" role="menuitem">0.75×</button>
          <button class="speed-option" data-speed="1" role="menuitem">1× (Normal)</button>
          <button class="speed-option" data-speed="1.25" role="menuitem">1.25×</button>
          <button class="speed-option" data-speed="1.5" role="menuitem">1.5×</button>
          <button class="speed-option" data-speed="2" role="menuitem">2×</button>
        </div>
      </div>

      <button id="fullscreenBtn" class="control-btn" aria-label="Pantalla completa" title="Pantalla completa"></button>
    </div>
  </div>


</section>

  <!-- ====== FOOTER ====== -->
  <footer>
    <div class="footer-container">
      <div class="footer-logo">
        <img src="Imagenes/IMRA-logo.png" alt="logo">
        <div class="logo-text">
          <div class="vertical-line"></div>
          <span class="vertical-ipmra">I<br>P<br>M<br>R<br>A</span>
        </div>
      </div>
      <div class="footer-contact">
        <h4>Síguenos en nuestra red social</h4>
        <ul>
          <li>
            <a class="boton-facebook" href="https://www.facebook.com/profile.php?id=100064632464818" target="_blank">
              <img src="Imagenes/facebook.png" alt="facebook" width="16px"> Visita nuestro Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Instituto Polivalente Modesto Rodas Alvarado - Todos los derechos reservados</p>
    </div>
  </footer>

  <!-- Script -->
  <script src="menu-desplegable.js"></script>
  <script>
    // Intento programático de reproducir videos y registrar errores (diagnóstico)
    document.addEventListener('DOMContentLoaded', function(){
      document.querySelectorAll('video').forEach(v => {
        // ensure playsinline flag for mobile
        try { v.playsInline = true; } catch(e){}
        // try to play and catch any Promise rejection
        const p = v.play();
        if(p && p.catch){
          p.catch(err => console.warn('No se pudo reproducir el video:', v.src, err));
        }
      });
    });

  document.addEventListener("DOMContentLoaded", () => {
  const wrap = document.getElementById('videoWrap');
  const video = document.getElementById('videoIPMRA');
  const playPause = document.getElementById('playPause');
  const volControl = document.getElementById('volControl');
  const volBtn = document.getElementById('volBtn');
  const volSlider = document.getElementById('volSlider');
  const progressContainer = document.getElementById('progressContainer');
  const progressBar = document.getElementById('progressBar');
  const progressBuffer = document.getElementById('progressBuffer');
  const timeDisplay = document.getElementById('time');
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  const speedBtn = document.getElementById('speedBtn');
  const speedMenu = document.getElementById('speedMenu');

  // SVGs
  const SVG_PLAY = `<svg viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path d="M9 7.5v9l6-4.5-6-4.5z" fill="currentColor"></path></svg>`;
  const SVG_PAUSE = `<svg viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path d="M7 6h3v12H7zM14 6h3v12h-3z" fill="currentColor"></path></svg>`;
  const SVG_VOL = `<svg viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path d="M4 10v4h4l5 5V5L8 10H4z" fill="currentColor"></path><path d="M16.5 8.5a4.5 4.5 0 010 7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path></svg>`;
  const SVG_MUTE = `<svg viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false"><path d="M4 10v4h4l5 5V5L8 10H4z" fill="currentColor"></path><path d="M19 8l-6.5 8M12.5 8L19 16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg>`;
  const SVG_VOL_LOW = `<svg viewBox="0 0 24 24" fill="none"><path d="M4 10v4h4l5 5V5L8 10H4z" fill="currentColor"></path><path d="M16 9a3 3 0 010 6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path></svg>`;
  const SVG_FULLSCREEN = `<svg viewBox="0 0 24 24" fill="none"><path d="M7 14H5v5h5v-2H7v-3zM17 19h-3v2h5v-5h-2v3zM5 5v5h2V7h3V5H5zm12 0v2h3v3h2V5h-5z" fill="currentColor"></path></svg>`;

  // init icons
  playPause.innerHTML = SVG_PLAY;
  volBtn.innerHTML = SVG_VOL;
  fullscreenBtn.innerHTML = SVG_FULLSCREEN;

  // helper
  function formatTime(sec){
    if (!isFinite(sec)) return '0:00';
    const s = Math.floor(sec % 60).toString().padStart(2,'0');
    const m = Math.floor((sec / 60) % 60);
    const h = Math.floor(sec / 3600);
    if (h > 0) return `${h}:${m.toString().padStart(2,'0')}:${s}`;
    return `${m}:${s}`;
  }

  // show/hide controls
  let hideTimer = null;
  function showControls(temp = true){
    wrap.classList.add('show-controls');
    if (hideTimer) { clearTimeout(hideTimer); hideTimer = null; }
    if (temp && window.innerWidth > 600) {
      hideTimer = setTimeout(() => { wrap.classList.remove('show-controls'); }, 2200);
    }
  }
  function hideControls(){
    wrap.classList.remove('show-controls');
    if (hideTimer) { clearTimeout(hideTimer); hideTimer = null; }
  }
  wrap.addEventListener('mouseenter', () => showControls(true));
  wrap.addEventListener('mousemove', () => showControls(true));
  wrap.addEventListener('focusin', () => showControls(false));
  wrap.addEventListener('mouseleave', () => {
    if (!wrap.matches(':focus') && !wrap.querySelector(':focus')) hideControls();
  });
  wrap.addEventListener('touchstart', (e) => {
    // touch: toggle controls (tap once to show, tap again to hide)
    if (wrap.classList.contains('show-controls')) hideControls();
    else showControls(false);
  }, {passive:true});

  // play/pause
  function togglePlay(){
    if (video.paused || video.ended) {
      video.play().catch(()=>{});
      playPause.innerHTML = SVG_PAUSE;
      playPause.setAttribute('aria-label','Pausar');
    } else {
      video.pause();
      playPause.innerHTML = SVG_PLAY;
      playPause.setAttribute('aria-label','Reproducir');
    }
    showControls(true);
  }
  playPause.addEventListener('click', togglePlay);
  video.addEventListener('click', togglePlay);
  video.addEventListener('play', () => playPause.innerHTML = SVG_PAUSE);
  video.addEventListener('pause', () => playPause.innerHTML = SVG_PLAY);

  // volume init: restore last value if available
  const savedVol = parseFloat(localStorage.getItem('imra_vol'));
  const savedMuted = localStorage.getItem('imra_muted');
  video.volume = !isNaN(savedVol) ? Math.min(1, Math.max(0, savedVol)) : 0.8;
  video.muted = savedMuted === '1' ? true : false;
  volSlider.value = video.muted ? 0 : video.volume;
  updateVolIcon();

  function updateVolIcon(){
    if (video.muted || video.volume === 0) {
      volBtn.innerHTML = SVG_MUTE;
      volBtn.setAttribute('aria-pressed','true');
    } else if (video.volume < 0.45) {
      volBtn.innerHTML = SVG_VOL_LOW;
      volBtn.setAttribute('aria-pressed','false');
    } else {
      volBtn.innerHTML = SVG_VOL;
      volBtn.setAttribute('aria-pressed','false');
    }
  }

  // Single control behavior:
  // - click volBtn toggles mute/unmute
  // - hover vol-control shows slider (CSS)
  // - on touch, tap volBtn toggles showing slider (add .open-volume)
  volBtn.addEventListener('click', (e) => {
    // if slider is visible and pointer is on slider, clicking icon still toggles mute
    toggleMute();
    showControls(true);
  });

  function toggleMute(){
    video.muted = !video.muted;
    if (video.muted) {
      localStorage.setItem('imra_muted','1');
      volSlider.value = 0;
    } else {
      localStorage.setItem('imra_muted','0');
      volSlider.value = video.volume;
    }
    updateVolIcon();
  }

  // slider change
  volSlider.addEventListener('input', (e) => {
    const v = parseFloat(e.target.value);
    video.volume = v;
    video.muted = v === 0;
    localStorage.setItem('imra_vol', String(video.volume));
    localStorage.setItem('imra_muted', video.muted ? '1' : '0');
    updateVolIcon();
    showControls(true);
  });

  // touch: tapping the volControl toggles slider visibility (instead of immediately muting)
  let volTouchTimer = null;
  volControl.addEventListener('touchstart', (e) => {
    // if slider already open, then let click on icon mute/unmute normally; otherwise open slider
    if (!volControl.classList.contains('open-volume')) {
      e.preventDefault(); // prevent accidental mute from click
      volControl.classList.add('open-volume');
      // auto-hide after 3s
      if (volTouchTimer) clearTimeout(volTouchTimer);
      volTouchTimer = setTimeout(() => volControl.classList.remove('open-volume'), 3000);
    } else {
      // let events proceed (next click can toggle mute)
    }
  }, {passive:false});

  // close volume slider when clicking outside
  document.addEventListener('click', (e) => {
    if (!volControl.contains(e.target)) volControl.classList.remove('open-volume');
  });

  // progreso & time
  video.addEventListener('loadedmetadata', () => {
    timeDisplay.textContent = formatTime(0) + (isFinite(video.duration) ? ' / ' + formatTime(video.duration) : '');
    updateBuffer();
  });
  video.addEventListener('timeupdate', () => {
    if (!isFinite(video.duration) || video.duration === 0) return;
    const pct = (video.currentTime / video.duration) * 100;
    progressBar.style.width = pct + '%';
    timeDisplay.textContent = formatTime(video.currentTime) + (isFinite(video.duration) ? ' / ' + formatTime(video.duration) : '');
    progressContainer.setAttribute('aria-valuenow', Math.round(pct));
  });
  function seek(e){
    const rect = progressContainer.getBoundingClientRect();
    const clientX = (e.clientX !== undefined) ? e.clientX : (e.touches && e.touches[0] && e.touches[0].clientX) || 0;
    const x = clientX - rect.left;
    const pct = Math.max(0, Math.min(1, x / rect.width));
    if (isFinite(video.duration)) video.currentTime = pct * video.duration;
    showControls(true);
  }
  progressContainer.addEventListener('click', seek);
  progressContainer.addEventListener('touchstart', (e) => { seek(e); }, {passive:true});
  function updateBuffer(){
    if(!video.buffered || video.buffered.length === 0 || !isFinite(video.duration)) { progressBuffer.style.width = '0%'; return; }
    const bufferedEnd = video.buffered.end(video.buffered.length - 1);
    const pct = (bufferedEnd / video.duration) * 100;
    progressBuffer.style.width = Math.min(100, pct) + '%';
  }
  video.addEventListener('progress', updateBuffer);

  // fullscreen
  const fullscreenBtnEl = document.getElementById('fullscreenBtn');
  fullscreenBtnEl.addEventListener('click', async () => {
    try {
      if (!document.fullscreenElement) {
        if (wrap.requestFullscreen) await wrap.requestFullscreen();
        else if (wrap.webkitRequestFullscreen) wrap.webkitRequestFullscreen();
      } else {
        if (document.exitFullscreen) await document.exitFullscreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      }
      showControls(false);
    } catch (err) { console.warn('Fullscreen error', err); }
  });

  // SPEED: load saved speed from localStorage (key: imra_speed)
  const savedSpeed = parseFloat(localStorage.getItem('imra_speed'));
  if (!isNaN(savedSpeed) && savedSpeed > 0) {
    video.playbackRate = savedSpeed;
    speedBtn.textContent = savedSpeed + '×';
  } else {
    speedBtn.textContent = (video.playbackRate || 1) + '×';
  }

  // speed menu
  speedBtn.addEventListener('click', (e) => {
    const opened = speedMenu.classList.toggle('show');
    speedBtn.setAttribute('aria-expanded', opened ? 'true' : 'false');
    speedMenu.setAttribute('aria-hidden', opened ? 'false' : 'true');
    if (opened) {
      const first = speedMenu.querySelector('.speed-option');
      if (first) first.focus();
    }
  });
  // choose speed + save
  speedMenu.addEventListener('click', (e) => {
    const opt = e.target.closest('.speed-option');
    if (!opt) return;
    const sp = parseFloat(opt.dataset.speed);
    video.playbackRate = sp;
    speedBtn.textContent = sp + '×';
    localStorage.setItem('imra_speed', String(sp)); // <-- guarda la preferencia
    speedMenu.classList.remove('show');
    speedBtn.setAttribute('aria-expanded','false');
    speedMenu.setAttribute('aria-hidden','true');
    showControls(true);
  });
  // close speed menu on outside click
  document.addEventListener('click', (e) => {
    if (!wrap.contains(e.target) && speedMenu.classList.contains('show')) {
      speedMenu.classList.remove('show');
      speedBtn.setAttribute('aria-expanded','false');
      speedMenu.setAttribute('aria-hidden','true');
    }
  });

  // keyboard shortcuts (incluye volumen y velocidad)
  wrap.addEventListener('keydown', (e) => {
    if (e.key === ' ' || e.key === 'Spacebar') { e.preventDefault(); togglePlay(); }
    if (e.key === 'm' || e.key === 'M') toggleMute();
    if (e.key === 'ArrowRight') { video.currentTime = Math.min(video.duration, video.currentTime + 5); showControls(true); }
    if (e.key === 'ArrowLeft') { video.currentTime = Math.max(0, video.currentTime - 5); showControls(true); }
    if (e.key === '>' || (e.key === '.' && e.shiftKey)) { video.playbackRate = Math.min(2, +(video.playbackRate + 0.25).toFixed(2)); speedBtn.textContent = video.playbackRate + '×'; localStorage.setItem('imra_speed', String(video.playbackRate)); showControls(true); }
    if (e.key === '<' || (e.key === ',' && e.shiftKey)) { video.playbackRate = Math.max(0.5, +(video.playbackRate - 0.25).toFixed(2)); speedBtn.textContent = video.playbackRate + '×'; localStorage.setItem('imra_speed', String(video.playbackRate)); showControls(true); }
    if (e.key === 'ArrowUp') { // subir volumen
      video.volume = Math.min(1, +(video.volume + 0.05).toFixed(2));
      video.muted = video.volume === 0;
      volSlider.value = video.volume;
      localStorage.setItem('imra_vol', String(video.volume));
      updateVolIcon();
      showControls(true);
    }
    if (e.key === 'ArrowDown') { // bajar volumen
      video.volume = Math.max(0, +(video.volume - 0.05).toFixed(2));
      video.muted = video.volume === 0;
      volSlider.value = video.volume;
      localStorage.setItem('imra_vol', String(video.volume));
      updateVolIcon();
      showControls(true);
    }
  });

  // initial play attempt
  video.play().then(()=>{ playPause.innerHTML = SVG_PAUSE; }).catch(()=>{ /* autoplay blocked or not allowed */ });

  // brief show controls on load
  showControls(true);
});

  </script>
</body>
</html>
